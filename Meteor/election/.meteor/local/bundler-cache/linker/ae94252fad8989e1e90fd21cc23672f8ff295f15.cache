[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar Mongo = Package.mongo.Mongo;\nvar _ = Package.underscore._;\n\n/* Package-scope variables */\nvar Internals, ServerMessages, ChannelListener, publishMethods;\n\n(function(){\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                        //\n// packages/gfk_server-messages/packages/gfk_server-messages.js                                           //\n//                                                                                                        //\n////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                          //\n(function () {                                                                                            // 1\n                                                                                                          // 2\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 3\n//                                                                                                  //    // 4\n// packages/gfk:server-messages/shared/internals.js                                                 //    // 5\n//                                                                                                  //    // 6\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 7\n                                                                                                    //    // 8\n/* global Internals:true*/                                                                          // 1  // 9\n                                                                                                    // 2  // 10\n/***                                                                                                // 3  // 11\n * Internal namespace used for constants and collection instance                                    // 4  // 12\n *                                                                                                  // 5  // 13\n * @namespace                                                                                       // 6  // 14\n * @type {{constants: {MAX_TIMESTAMP_AGE: number}, collection: Mongo.Collection}}                   // 7  // 15\n */                                                                                                 // 8  // 16\nInternals = {                                                                                       // 9  // 17\n  constants: {                                                                                      // 10\n    MAX_TIMESTAMP_AGE: 2500                                                                         // 11\n  },                                                                                                // 12\n  collection: new Mongo.Collection('servermessages')                                                // 13\n};                                                                                                  // 14\n                                                                                                    // 15\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 24\n                                                                                                          // 25\n}).call(this);                                                                                            // 26\n                                                                                                          // 27\n                                                                                                          // 28\n                                                                                                          // 29\n                                                                                                          // 30\n                                                                                                          // 31\n                                                                                                          // 32\n(function () {                                                                                            // 33\n                                                                                                          // 34\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 35\n//                                                                                                  //    // 36\n// packages/gfk:server-messages/shared/serverMessages.js                                            //    // 37\n//                                                                                                  //    // 38\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 39\n                                                                                                    //    // 40\nServerMessages = function (name) {                                                                  // 1  // 41\n  this._name = name || 'default';                                                                   // 2  // 42\n                                                                                                    // 3  // 43\n  if (_.isFunction(this._init)) {                                                                   // 4  // 44\n    //Client/server specific part of constructor                                                    // 5  // 45\n    this._init.apply(this, arguments);                                                              // 6  // 46\n  }                                                                                                 // 7  // 47\n};                                                                                                  // 8  // 48\n                                                                                                    // 9  // 49\nServerMessages.prototype = {};                                                                      // 10\n                                                                                                    // 11\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 52\n                                                                                                          // 53\n}).call(this);                                                                                            // 54\n                                                                                                          // 55\n                                                                                                          // 56\n                                                                                                          // 57\n                                                                                                          // 58\n                                                                                                          // 59\n                                                                                                          // 60\n(function () {                                                                                            // 61\n                                                                                                          // 62\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 63\n//                                                                                                  //    // 64\n// packages/gfk:server-messages/client/channelListener.js                                           //    // 65\n//                                                                                                  //    // 66\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 67\n                                                                                                    //    // 68\n/* global ChannelListener:true*/                                                                    // 1  // 69\n                                                                                                    // 2  // 70\nChannelListener = function (channel, collection) {                                                  // 3  // 71\n  this.handlers = [];                                                                               // 4  // 72\n  this.channel = channel;                                                                           // 5  // 73\n                                                                                                    // 6  // 74\n  this._observe = collection.find({                                                                 // 7  // 75\n    channel: channel                                                                                // 8  // 76\n  }).observe({                                                                                      // 9  // 77\n    added: this._handleMessage.bind(this)                                                           // 10\n  });                                                                                               // 11\n};                                                                                                  // 12\n                                                                                                    // 13\nChannelListener.prototype.addHandler = function (handler) {                                         // 14\n  this.handlers.push(handler);                                                                      // 15\n};                                                                                                  // 16\n                                                                                                    // 17\nChannelListener.prototype.destroy = function () {                                                   // 18\n  this._observe.stop();                                                                             // 19\n};                                                                                                  // 20\n                                                                                                    // 21\nChannelListener.prototype._handleMessage = function (message) {                                     // 22\n  _.each(this.handlers, function (handler) {                                                        // 23\n    handler.apply(handler, message.arguments);                                                      // 24\n  });                                                                                               // 25\n};                                                                                                  // 26\n                                                                                                    // 27\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 96\n                                                                                                          // 97\n}).call(this);                                                                                            // 98\n                                                                                                          // 99\n                                                                                                          // 100\n                                                                                                          // 101\n                                                                                                          // 102\n                                                                                                          // 103\n                                                                                                          // 104\n(function () {                                                                                            // 105\n                                                                                                          // 106\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 107\n//                                                                                                  //    // 108\n// packages/gfk:server-messages/client/serverMessages.js                                            //    // 109\n//                                                                                                  //    // 110\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 111\n                                                                                                    //    // 112\n_.extend(ServerMessages.prototype, {                                                                // 1  // 113\n  /***                                                                                              // 2  // 114\n   * Part of constructor that is server/client specific                                             // 3  // 115\n   * @private                                                                                       // 4  // 116\n   */                                                                                               // 5  // 117\n  _init: function () {                                                                              // 6  // 118\n    this._listeners = {};                                                                           // 7  // 119\n    this._subscription = Meteor.subscribe('ServerMessages/publishMessages', this._name);            // 8  // 120\n  },                                                                                                // 9  // 121\n  /***                                                                                              // 10\n   * Listen to a certain channel, execute the given handler when a message arrives                  // 11\n   *                                                                                                // 12\n   * @param channel the channel to listen to                                                        // 13\n   * @param handler the handler to execute upon a new message                                       // 14\n   */                                                                                               // 15\n  listen: function (channel, handler) {                                                             // 16\n    if (!this._listeners[channel]) {                                                                // 17\n      this._addChannelListener(channel);                                                            // 18\n    }                                                                                               // 19\n                                                                                                    // 20\n    this._listeners[channel].addHandler(handler);                                                   // 21\n  },                                                                                                // 22\n  /***                                                                                              // 23\n   * Instantiates a new ChannelListener for the given channel                                       // 24\n   * @param channel the channel to listen to                                                        // 25\n   * @private                                                                                       // 26\n   */                                                                                               // 27\n  _addChannelListener: function (channel) {                                                         // 28\n    this._listeners[channel] = new ChannelListener(                                                 // 29\n      channel,                                                                                      // 30\n      Internals.collection                                                                          // 31\n    );                                                                                              // 32\n  },                                                                                                // 33\n  /***                                                                                              // 34\n   * Cleans up current subscription and oberves on the collection.                                  // 35\n   * Call this before setting the reference to ServerMessages to undefined to prevent memory leaks. // 36\n   */                                                                                               // 37\n  destroy: function () {                                                                            // 38\n    _.invoke(this._listeners, 'destroy');                                                           // 39\n    this._subscription.stop();                                                                      // 40\n  }                                                                                                 // 41\n});                                                                                                 // 42\n                                                                                                    // 43\n//////////////////////////////////////////////////////////////////////////////////////////////////////    // 156\n                                                                                                          // 157\n}).call(this);                                                                                            // 158\n                                                                                                          // 159\n////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n/* Exports */\nif (typeof Package === 'undefined') Package = {};\nPackage['gfk:server-messages'] = {\n  ServerMessages: ServerMessages,\n  ChannelListener: ChannelListener,\n  Internals: Internals,\n  publishMethods: publishMethods\n};\n\n})();\n","servePath":"/packages/gfk_server-messages.js","sourceMap":{"version":3,"sources":["/packages/gfk_server-messages/packages/gfk_server-messages.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gH","file":"/packages/gfk_server-messages.js","sourcesContent":["(function () {\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                  //\n// packages/gfk:server-messages/shared/internals.js                                                 //\n//                                                                                                  //\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                    //\n/* global Internals:true*/                                                                          // 1\n                                                                                                    // 2\n/***                                                                                                // 3\n * Internal namespace used for constants and collection instance                                    // 4\n *                                                                                                  // 5\n * @namespace                                                                                       // 6\n * @type {{constants: {MAX_TIMESTAMP_AGE: number}, collection: Mongo.Collection}}                   // 7\n */                                                                                                 // 8\nInternals = {                                                                                       // 9\n  constants: {                                                                                      // 10\n    MAX_TIMESTAMP_AGE: 2500                                                                         // 11\n  },                                                                                                // 12\n  collection: new Mongo.Collection('servermessages')                                                // 13\n};                                                                                                  // 14\n                                                                                                    // 15\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                  //\n// packages/gfk:server-messages/shared/serverMessages.js                                            //\n//                                                                                                  //\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                    //\nServerMessages = function (name) {                                                                  // 1\n  this._name = name || 'default';                                                                   // 2\n                                                                                                    // 3\n  if (_.isFunction(this._init)) {                                                                   // 4\n    //Client/server specific part of constructor                                                    // 5\n    this._init.apply(this, arguments);                                                              // 6\n  }                                                                                                 // 7\n};                                                                                                  // 8\n                                                                                                    // 9\nServerMessages.prototype = {};                                                                      // 10\n                                                                                                    // 11\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                  //\n// packages/gfk:server-messages/client/channelListener.js                                           //\n//                                                                                                  //\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                    //\n/* global ChannelListener:true*/                                                                    // 1\n                                                                                                    // 2\nChannelListener = function (channel, collection) {                                                  // 3\n  this.handlers = [];                                                                               // 4\n  this.channel = channel;                                                                           // 5\n                                                                                                    // 6\n  this._observe = collection.find({                                                                 // 7\n    channel: channel                                                                                // 8\n  }).observe({                                                                                      // 9\n    added: this._handleMessage.bind(this)                                                           // 10\n  });                                                                                               // 11\n};                                                                                                  // 12\n                                                                                                    // 13\nChannelListener.prototype.addHandler = function (handler) {                                         // 14\n  this.handlers.push(handler);                                                                      // 15\n};                                                                                                  // 16\n                                                                                                    // 17\nChannelListener.prototype.destroy = function () {                                                   // 18\n  this._observe.stop();                                                                             // 19\n};                                                                                                  // 20\n                                                                                                    // 21\nChannelListener.prototype._handleMessage = function (message) {                                     // 22\n  _.each(this.handlers, function (handler) {                                                        // 23\n    handler.apply(handler, message.arguments);                                                      // 24\n  });                                                                                               // 25\n};                                                                                                  // 26\n                                                                                                    // 27\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                  //\n// packages/gfk:server-messages/client/serverMessages.js                                            //\n//                                                                                                  //\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                    //\n_.extend(ServerMessages.prototype, {                                                                // 1\n  /***                                                                                              // 2\n   * Part of constructor that is server/client specific                                             // 3\n   * @private                                                                                       // 4\n   */                                                                                               // 5\n  _init: function () {                                                                              // 6\n    this._listeners = {};                                                                           // 7\n    this._subscription = Meteor.subscribe('ServerMessages/publishMessages', this._name);            // 8\n  },                                                                                                // 9\n  /***                                                                                              // 10\n   * Listen to a certain channel, execute the given handler when a message arrives                  // 11\n   *                                                                                                // 12\n   * @param channel the channel to listen to                                                        // 13\n   * @param handler the handler to execute upon a new message                                       // 14\n   */                                                                                               // 15\n  listen: function (channel, handler) {                                                             // 16\n    if (!this._listeners[channel]) {                                                                // 17\n      this._addChannelListener(channel);                                                            // 18\n    }                                                                                               // 19\n                                                                                                    // 20\n    this._listeners[channel].addHandler(handler);                                                   // 21\n  },                                                                                                // 22\n  /***                                                                                              // 23\n   * Instantiates a new ChannelListener for the given channel                                       // 24\n   * @param channel the channel to listen to                                                        // 25\n   * @private                                                                                       // 26\n   */                                                                                               // 27\n  _addChannelListener: function (channel) {                                                         // 28\n    this._listeners[channel] = new ChannelListener(                                                 // 29\n      channel,                                                                                      // 30\n      Internals.collection                                                                          // 31\n    );                                                                                              // 32\n  },                                                                                                // 33\n  /***                                                                                              // 34\n   * Cleans up current subscription and oberves on the collection.                                  // 35\n   * Call this before setting the reference to ServerMessages to undefined to prevent memory leaks. // 36\n   */                                                                                               // 37\n  destroy: function () {                                                                            // 38\n    _.invoke(this._listeners, 'destroy');                                                           // 39\n    this._subscription.stop();                                                                      // 40\n  }                                                                                                 // 41\n});                                                                                                 // 42\n                                                                                                    // 43\n//////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n"]}}]